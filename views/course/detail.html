<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Course Detail Page</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-gray-100">
    <header>
      <nav class="bg-white border-b shadow">
        <div
          id="topNav"
          class="container mx-auto flex justify-between items-center py-4 px-4 lg:px-8"
        >
          <a class="flex items-center" href="/">
            <img
              id="logo"
              src="../../static/img/Logo.png"
              alt="IT Learning Logo"
              class="w-8 h-8 mr-2"
            />
            <span class="font-bold text-xl text-gray-700">IT Learning</span>
          </a>

          <button
            class="lg:hidden flex items-center px-3 py-2 border rounded text-gray-500 border-gray-400"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarTogglerDemo01"
            aria-controls="navbarTogglerDemo01"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <svg class="fill-current h-5 w-5" viewBox="0 0 20 20">
              <path d="M0 3h20v2H0V3zm0 5h20v2H0V8zm0 5h20v2H0v-2z" />
            </svg>
          </button>

          <div class="hidden lg:flex space-x-8 items-center">
            <ul class="flex space-x-6 text-gray-700 font-semibold">
              <li><a class="hover:text-blue-500" href="/">Home</a></li>
              <li>
                <a class="hover:text-blue-500" href="aboutUs">About Us</a>
              </li>
              <li class="relative group">
                <a class="hover:text-blue-500 flex items-center cursor-pointer">
                  Browse
                  <svg
                    class="w-4 h-4 ml-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    ></path>
                  </svg>
                </a>
                <ul
                  class="absolute hidden group-hover:block bg-white shadow-lg rounded mt-1 text-sm"
                >
                  <li>
                    <a class="block px-4 py-2 hover:bg-gray-200" href="#"
                      >Browse Courses by Category</a
                    >
                  </li>
                  <li>
                    <a class="block px-4 py-2 hover:bg-gray-200" href="#"
                      >Browse Courses by Name</a
                    >
                  </li>
                  <li class="border-t">
                    <a class="block px-4 py-2 hover:bg-gray-200" href="#"
                      >Browse Instructors</a
                    >
                  </li>
                </ul>
              </li>
              <li><a class="hover:text-blue-500" href="pricing">Pricing</a></li>
              <li><a class="hover:text-blue-500" href="/">My Account</a></li>
              <li><a class="hover:text-blue-500" href="faq">FAQs</a></li>
              <li>
                <a class="hover:text-blue-500" href="contactPage">Contact</a>
              </li>
            </ul>

            <form class="flex items-center space-x-2">
              <input
                class="form-input border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring focus:border-blue-300"
                id="nav-search-input"
                type="search"
                placeholder="Type Course Names"
                aria-label="Search"
              />
              <button
                class="btn bg-green-500 text-white rounded-lg px-4 py-2 hover:bg-green-600"
                id="nav-button"
                type="submit"
              >
                Search
              </button>
            </form>
          </div>
        </div>

        <div class="lg:hidden">
          <div class="collapse navbar-collapse" id="navbarTogglerDemo01">
            <ul class="flex flex-col space-y-4 p-4">
              <li><a class="hover:text-blue-500" href="/">Home</a></li>
              <li>
                <a class="hover:text-blue-500" href="aboutUs">About Us</a>
              </li>
              <li class="relative group">
                <a class="hover:text-blue-500 flex items-center cursor-pointer">
                  Browse
                  <svg
                    class="w-4 h-4 ml-1"
                    fill="none"
                    stroke="currentColor"
                    viewBox="0 0 24 24"
                  >
                    <path
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                      d="M19 9l-7 7-7-7"
                    ></path>
                  </svg>
                </a>
                <ul class="mt-2 space-y-2">
                  <li>
                    <a class="block px-4 py-2 hover:bg-gray-200" href="#"
                      >Browse Courses by Category</a
                    >
                  </li>
                  <li>
                    <a class="block px-4 py-2 hover:bg-gray-200" href="#"
                      >Browse Courses by Name</a
                    >
                  </li>
                  <li class="border-t">
                    <a class="block px-4 py-2 hover:bg-gray-200" href="#"
                      >Browse Instructors</a
                    >
                  </li>
                </ul>
              </li>
              <li><a class="hover:text-blue-500" href="pricing">Pricing</a></li>
              <li><a class="hover:text-blue-500" href="/">My Account</a></li>
              <li><a class="hover:text-blue-500" href="faq">FAQs</a></li>
              <li>
                <a class="hover:text-blue-500" href="contactPage">Contact</a>
              </li>
            </ul>
            <form class="flex flex-col space-y-4 p-4">
              <input
                class="form-input border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring focus:border-blue-300"
                id="nav-search-input"
                type="search"
                placeholder="Type Course Names"
                aria-label="Search"
              />
              <button
                class="btn bg-green-500 text-white rounded-lg px-4 py-2 hover:bg-green-600"
                id="nav-button"
                type="submit"
              >
                Search
              </button>
            </form>
          </div>
        </div>
      </nav>
    </header>

    <div class="container mx-auto py-8" id="course-container">
      <!-- Content will be dynamically inserted here -->
    </div>

    <div id="footer" class="bg-gray-800 text-white py-10">
      <div class="container mx-auto px-4">
        <!-- Top Section: Companies & Slogan -->
        <div
          class="flex flex-col lg:flex-row justify-between items-center mb-8"
        >
          <h4
            class="text-lg font-semibold text-center lg:text-left mb-6 lg:mb-0"
          >
            Top companies choose ITLearning to build in-demand career skills.
          </h4>
          <div class="flex justify-center lg:justify-end space-x-6">
            <img
              src="../../static/img/company.png"
              alt="Volkswagen"
              class="h-16 w-16"
            />
            <img
              src="../../static/img/company2.svg"
              alt="Box"
              class="h-16 w-16"
            />
            <img
              src="../../static/img/company1.png"
              alt="NetApp"
              class="h-16 w-16"
            />
          </div>
        </div>

        <!-- Links Section -->
        <div
          class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 text-center sm:text-left mb-8"
        >
          <div>
            <p><a href="#" class="hover:underline">Teach on ITLearning</a></p>
            <p><a href="#" class="hover:underline">About us</a></p>
            <p><a href="#" class="hover:underline">Contact us</a></p>
          </div>
          <div>
            <p><a href="#" class="hover:underline">Help and Support</a></p>
            <p><a href="#" class="hover:underline">Affiliate</a></p>
            <p><a href="#" class="hover:underline">Investors</a></p>
          </div>
          <div>
            <p><a href="#" class="hover:underline">Terms & Services</a></p>
            <p><a href="#" class="hover:underline">Privacy Policy</a></p>
            <p><a href="#" class="hover:underline">FAQs</a></p>
          </div>
        </div>

        <!-- Bottom Section: Logo and Copyright -->
        <div
          class="flex flex-col sm:flex-row justify-between items-center border-t border-gray-700 pt-6"
        >
          <div class="flex items-center space-x-4 mb-4 sm:mb-0">
            <img src="../../static/img/Logo.png" alt="Logo" class="h-10 w-10" />
            <span>&copy; 2024 ITLearning. All Rights Reserved.</span>
          </div>
          <div>
            <a href="#" class="hover:underline text-gray-400">Privacy Policy</a>
            <span class="mx-2">|</span>
            <a href="#" class="hover:underline text-gray-400">Terms of Use</a>
          </div>
        </div>
      </div>
    </div>

    <script>
      let courseName = "";
      let coursePrice = "";
      let courseImg = "";

      function formatPrice(price) {
        let formattedPrice = price.toLocaleString("vi-VN"); // Format price for Vietnamese locale
        // Check if the price is a whole number, and append ".000"
        if (Number.isInteger(price)) {
          formattedPrice += ".000";
        }
        return formattedPrice;
      }
      const courseId = "66e07cb88a0cafe880f72f3a";
      const apiBaseUrl = "http://localhost:3000";

      // Function to fetch course details and lectures
      async function fetchCourseDetails() {
        try {
          // Fetch course details
          const courseResponse = await fetch(
            `${apiBaseUrl}/courses/${courseId}`
          );
          if (!courseResponse.ok)
            throw new Error("Failed to fetch course details");
          const courseData = await courseResponse.json();

          courseName = courseData.name;
          instructorId = courseData.instructorId;
          coursePrice = formatPrice(courseData.price);
          courseImg = courseData.thumbnailImage;

          displayCourseDetails(courseData);

          // Fetch lectures
          const lecturesResponse = await fetch(
            `${apiBaseUrl}/lectures/course/${courseId}`
          );
          if (!lecturesResponse.ok) throw new Error("Failed to fetch lectures");
          const lecturesData = await lecturesResponse.json();
          displayCourseLectures(lecturesData);
        } catch (error) {
          console.error("Error:", error);
          document.getElementById("course-container").innerHTML =
            "<p>Failed to load course data.</p>";
        }
      }

      // Function to display course details
      function displayCourseDetails(course) {
        const courseContainer = document.getElementById("course-container");

        // Generate random rating and other details
        const randomRating = (Math.random() * 4 + 1).toFixed(1); // Between 1.0 and 5.0
        const randomRatingCount =
          Math.floor(Math.random() * (10000 - 30 + 1)) + 100; // Between 100 and 10000
        const randomLearners =
          Math.floor(Math.random() * (10000 - 1000 + 1)) + 100;

        courseContainer.innerHTML = `
                      <!-- Breadcrumb -->
                      <div class="text-sm mb-4 text-gray-600">
                          <a href="#" class="hover:underline">Home</a> >
                          <a href="#" class="hover:underline">${
                            course.category
                          }</a> >
                          <a href="#" class="text-gray-900 hover:underline">${
                            course.name
                          }</a>
                      </div>

                      <!-- Course Image -->
                      <div class="mb-6">
                          <img src="${course.thumbnailImage}" alt="${
          course.name
        }" class="w-full h-auto rounded-lg shadow-lg" style="width: 1300px; height: 300px; object-fit: cover;">
                      </div>

                      <!-- Course Header -->
                      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                          <div class="col-span-2">
                              <h1 class="text-3xl font-bold">${course.name}</h1>
                              <p class="text-lg mt-2">Get yourself overwhelmed with fantastic contents our course provide</p>
                              <div class="flex items-center mt-4">
                                  <span class="text-yellow-400 text-xl">★ ${randomRating}</span>
                                  <span class="ml-2 text-gray-600">(${randomRatingCount} ratings)</span>
                                  <span class="ml-4 text-gray-600">${randomLearners} learners by far</span>
                              </div>
                              <p class="mt-2 text-gray-600">Course by <a href="#" class="text-indigo-600 hover:underline">${
                                course.instructorId.firstName
                              } ${course.instructorId.lastName}</a></p>
                              <p class="text-gray-500">Date: ${new Date(
                                course.createTime
                              ).toLocaleDateString()}</p>

                              <!-- Placeholder for Course Lectures (will be dynamically inserted) -->
                              <div id="course-lectures"></div>

                              <!-- Description -->
                              <div class="mt-8">
                                  <h2 class="text-2xl font-semibold">Course Description</h2>
                                  <p class="text-gray-700 mt-4 leading-relaxed">
                                      ${course.description}
                                  </p>
                              </div>
                          </div>

                          <!-- Sidebar (Price and Buy Section) -->
                          <div class="bg-white p-6 shadow-lg rounded-lg">
                              <p class="text-3xl font-semibold text-purple-600"> ${formatPrice(
                                course.price
                              )} đ</p>
                              <div class="flex items-center">
                                  <!-- Add to Cart Button -->
                                  <button id="add-to-cart" class="mt-4 bg-purple-600 text-white py-2 px-4 mr-5 w-full rounded-md">Add to cart</button>

                                  <!-- Heart Icon Button -->
                                  <button id="favoriteBtn" class="text-red-500 border border-gray-300 p-2">
                                      <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" viewBox="0 0 24 24" fill="currentColor" id="heartIcon">
                                          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/>
                                      </svg>
                                  </button>
                              </div>
                              <button id="buyNowBtn" class="mt-2 border border-purple-600 text-purple-600 py-2 px-4 w-full rounded-md">Buy now</button>
                              <p class="text-gray-500 mt-2">&copy; Certified by ITLearning</p>
                              <div class="mt-6">
                                  <h4 class="font-semibold">This course include:</h4>
                                  <ul class="mt-2 space-y-2 text-gray-700">
                                      <li>✔️ 30 minutes videos</li>
                                      <li>✔️ Quizzes</li>
                                      <li>✔️ Full access on many devices: include phone, tablet, and laptops</li>
                                      <li>✔️ Lifetime access</li>
                                      <li>✔️ Certificate</li>
                                  </ul>
                              </div>
                          </div>
                      </div>
                  `;

        // Add event listener for the "Buy now" button
        document.getElementById("buyNowBtn").addEventListener("click", () => {
          // Redirect to the payment page with the course data
          const payUrl = new URL("http://localhost:5500/views/course/pay.html");
          payUrl.searchParams.append("instructorId", instructorId);
          payUrl.searchParams.append("courseId", courseId);
          payUrl.searchParams.append("courseName", courseName);
          payUrl.searchParams.append("price", coursePrice);
          payUrl.searchParams.append("courseImg", courseImg);

          window.location.href = payUrl.toString();
        });

        // Duong modification start: Event listener for Add to Cart button
        const addToCartButton = document.getElementById("add-to-cart");
        if (addToCartButton) {
          addToCartButton.addEventListener("click", function () {
            const courseToAdd = {
              id: course._id,
              title: course.name,
              price: course.price,
              category: course.category,
              description: course.description,
              instructor: `${course.instructorId.firstName} ${course.instructorId.lastName}`,
              thumbnail: course.thumbnailImage,
              isPublish: course.isPublish,
            };

            // Retrieve cart from localStorage or initialize an empty array
            let cart = JSON.parse(localStorage.getItem("cart")) || [];
            cart.push(courseToAdd);
            localStorage.setItem("cart", JSON.stringify(cart));

            alert("Course added to cart!");
          });
        }
      }
      // Duong modification End:

      // Function to display course lectures
      function displayCourseLectures(lectures) {
        const lectureCount = lectures.length;
        const lectureTotalTime = lectureCount * 30; // Assuming each lecture is 30 minutes
        const lecturesContainer = document.getElementById("course-lectures");

        const courseContentContainer = document.createElement("div");
        courseContentContainer.classList.add("mt-8");
        courseContentContainer.innerHTML = `
                      <h2 class="text-2xl font-semibold">Course content:</h2>
                      <p class="text-gray-600 mb-4"> ${lectureCount} lectures • ${lectureTotalTime} mins </p>
                      <div id="lecture-list" class="space-y-4 mt-4"></div>
                  `;

        const lectureList =
          courseContentContainer.querySelector("#lecture-list");

        lectures.forEach((lecture) => {
          const lectureItem = document.createElement("div");
          lectureItem.classList.add("bg-gray-100", "p-4", "rounded-lg");
          lectureItem.innerHTML = `
                          <h3 class="text-lg font-semibold">${lecture.title}</h3>
                          <p class="text-gray-600 mt-1">${lecture.description}</p>
                          <p class="text-gray-500 text-sm mt-1">Duration: ${lecture.duration} mins</p>
                      `;
          lectureList.appendChild(lectureItem);
        });

        lecturesContainer.appendChild(courseContentContainer);
      }

      // Fetch course details on page load
      document.addEventListener("DOMContentLoaded", fetchCourseDetails);
    </script>
  </body>
</html>
